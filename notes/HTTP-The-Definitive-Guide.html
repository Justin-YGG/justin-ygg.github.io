<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>透视HTTP协议</title>
<!-- 2020-03-03 Tue 23:12 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Justin" />
<link rel="stylesheet" type="text/css" href="/css/worg.css"/>
<link rel="icon" type="image/png" href="/img/icons/heckert.png">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">透视HTTP协议</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">名词解释</a></li>
<li><a href="#sec-2">01| 时势与英雄：HTTP 的前世今生</a></li>
<li><a href="#sec-3">02| HTTP 是什么？HTTP 又不是什么？</a>
<ul>
<li><a href="#sec-3-1">HTTP 是什么？</a></li>
</ul>
</li>
<li><a href="#sec-4">03 | HTTP世界全览（上）：与HTTP相关的各种概念</a></li>
<li><a href="#sec-5">04 | HTTP世界全览（下）：与HTTP相关的各种协议</a></li>
<li><a href="#sec-6">05 | 常说的“四层”和“七层”到底是什么？“五层”“六层”哪去了？</a>
<ul>
<li><a href="#sec-6-1">四层模型</a></li>
<li><a href="#sec-6-2">七层模型</a></li>
</ul>
</li>
<li><a href="#sec-7">06 | 域名里有哪些门道？</a>
<ul>
<li><a href="#sec-7-1">域名解析</a></li>
<li><a href="#sec-7-2">域名新玩法</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">名词解释</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>HTTP：HyperText Transfer Protocol 超文本传输协议
</li>
<li>CDN: Content Delivery Network 内容分发网络
</li>
<li>IP 协议: Internet Protocol
</li>
<li>TCP 协议：Transmission Control Protocol
</li>
<li>DNS: Domain Name System 域名系统，域名”（Domain Name）又称为“主机名”（Host）
</li>
<li>URI： Uniform Resource Identifier，统一资源标识符，唯一地标记互联网上资源
</li>
<li>URL：Uniform Resource Locator， 统一资源定位符，URI 的一个子集
</li>
<li>HTTPS：HTTP over SSL/TLS
</li>
<li>SSL： Secure Socket Layer，当发展到 3.0 时被标准化，改名为 TLS，即“Transport Layer Security”，但由于历史的原因还是有很多人称之为 SSL/TLS，或者直接简称为 SSL。
</li>
<li>OSI: Open System Interconnection Reference Model, 开放式系统互联通信参考模型
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">01| 时势与英雄：HTTP 的前世今生</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>HTTP 协议始于三十年前蒂姆·伯纳斯 - 李的一篇论文
</li>
<li>HTTP/0.9 是个简单的文本协议，只能获取文本资源
</li>
<li>HTTP/1.0 确立了大部分现在使用的技术，但它不是正式标准
</li>
<li>HTTP/1.1 是目前互联网上使用最广泛的协议，功能也非常完善
</li>
<li>HTTP/2 基于 Google 的 SPDY 协议，注重性能改善，但还未普及
</li>
<li>HTTP/3 基于 Google 的 QUIC 协议，是将来的发展方向。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">02| HTTP 是什么？HTTP 又不是什么？</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">HTTP 是什么？</h3>
<div class="outline-text-3" id="text-3-1">
<p>
<b>超文本传输协议</b> ，它可以拆成三个部分，分别是： <b>超文本</b> 、 <b>传输</b> 和 <b>协议</b> 。
</p>


<div class="figure">
<p><img src="../img/http/http.jpg" alt="http.jpg" width="400" />
</p>
</div>

<ul class="org-ul">
<li>协议：HTTP 是一个用在计算机世界里的协议。它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。
</li>
<li>传输：HTTP 是一个在计算机世界里专门用来在两点之间传输数据的约定和规范。
</li>
<li>超文本：HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。
</li>
</ul>

<p>
<b>我们可以把 HTTP 定义为“与 HTTP 协议相关的所有应用层技术的总和”。</b>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">03 | HTTP世界全览（上）：与HTTP相关的各种概念</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>互联网上绝大部分资源都使用 HTTP 协议传输
</li>
<li>浏览器是 HTTP 协议里的请求方，即 User Agent
</li>
<li>服务器是 HTTP 协议里的应答方，常用的有 Apache 和 Nginx
</li>
<li>CDN 位于浏览器和服务器之间，主要起到缓存加速的作用
</li>
<li>爬虫是另一类 User Agent，是自动访问网络资源的程序
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">04 | HTTP世界全览（下）：与HTTP相关的各种协议</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>TCP/IP 是网络世界最常用的协议，HTTP 通常运行在 TCP/IP 提供的可靠传输基础上
</li>
<li>DNS 域名是 IP 地址的等价替代，需要用域名解析实现到 IP 地址的映射
</li>
<li>URI 是用来标记互联网上资源的一个名字，由“协议名 + 主机名 + 路径”构成，俗称 URL
</li>
<li>HTTPS 相当于“HTTP+SSL/TLS+TCP/IP”，为 HTTP 套了一个安全的外壳
</li>
<li>代理是 HTTP 传输过程中的“中转站”，可以实现缓存加速、负载均衡等功能
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">05 | 常说的“四层”和“七层”到底是什么？“五层”“六层”哪去了？</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">四层模型</h3>
<div class="outline-text-3" id="text-6-1">

<div class="figure">
<p><img src="../img/http/tcp-ip-4.png" alt="tcp-ip-4.png" width="400" />
</p>
</div>

<ul class="org-ul">
<li>linker layer: 链接层，负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，所以有时候也叫 MAC 层。
</li>
<li>internet layer: 网际层或者网络互连层，IP 协议就处在这一层。因为 IP 协议定义了“IP 地址”的概念，所以就可以在“链接层”的基础上，用 IP 地址取代 MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。
</li>
<li>transport layer: 传输层，这个层次协议的职责是保证数据在 IP 地址标记的两点之间“可靠”地传输，是 TCP 协议工作的层次，另外还有它的一个“小伙伴”UDP。
</li>
<li>application layer：应用层，有各种面向具体应用的协议。例如 Telnet、SSH、FTP、SMTP 等等，当然还有 HTTP。 <b>DNS, CDN 都工作在应用层</b>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">七层模型</h3>
<div class="outline-text-3" id="text-6-2">
<p>
<b>OSI，全称是“开放式系统互联通信参考模型”（Open System Interconnection Reference Model）</b>
</p>


<div class="figure">
<p><img src="../img/http/tcp-ip-7.png" alt="tcp-ip-7.png" width="400" />
</p>
</div>

<ul class="org-ul">
<li>第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等
</li>
<li>第二层：数据链路层，它基本相当于 TCP/IP 的链接层
</li>
<li>第三层：网络层，相当于 TCP/IP 里的网际层
</li>
<li>第四层：传输层，相当于 TCP/IP 里的传输层
</li>
<li>第五层：会话层，维护网络中的连接状态，即保持会话和同步
</li>
<li>第六层：表示层，把数据转换为合适、可理解的语法和语义
</li>
<li>第七层：应用层，面向具体的应用传输数据
</li>
</ul>

<p>
<b>二层转发，三层路由</b>
</p>

<p>
二层转发就意味着是在数据链路层（Data Link Layer）做的转发，基于 MAC 地址，通常指的是交换机；三层路由意味着是在网络层（Network Layer）做的转发，通常指的是路由器（当然也有路由功能的交换机）；当数据传输到网络层，路由器会检查目的 IP 是否与自己处于同一网段，是则进行二层转发即请求目的主机的 MAC 地址，否则进行三层转发即进入路由的递归查找。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">06 | 域名里有哪些门道？</h2>
<div class="outline-text-2" id="text-7">
<p>
<b>域名结构</b> ：主机.二级域名.顶级域名
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">域名解析</h3>
<div class="outline-text-3" id="text-7-1">

<div class="figure">
<p><img src="../img/http/dns.png" alt="dns.png" width="400" />
</p>
</div>

<p>
<b>Dns 的核心系统是一个三层的树状、分布式服务，基本对应域名的结构：</b>
</p>

<ul class="org-ul">
<li>根域名服务器（Root DNS Server）：管理顶级域名服务器，返回“com”“net”“cn”等顶级域名服务器的 IP 地址
</li>
<li>顶级域名服务器（Top-level DNS Server）：管理各自域名下的权威域名服务器，比如 com 顶级域名服务器可以返回 apple.com 域名服务器的 IP 地
</li>
<li>权威域名服务器（Authoritative DNS Server）：管理自己域名下主机的 IP 地址，比如 apple.com 权威域名服务器可以返回 www.apple.com 的 IP 地址
</li>
</ul>

<p>
全世界共有 13 组根域名服务器，虽然又有数百台镜像，但为了减轻域名解析的压力，采用的基本思路是 <b>缓存</b> 。
</p>

<ul class="org-ul">
<li>浏览器缓存
</li>
<li>操作系统缓存
</li>
<li>host 文件
</li>
<li>网络运营商自建 DNS 服务器，“野生”服务器被称为“非权威域名服务器”，比较知名的 DNS 有 Google 的“8.8.8.8”，Microsoft 的“4.2.2.1”
</li>
</ul>

<p>
<b>那么浏览器里输入 www.apple.com，具体的 DNS 解析过程是怎样的呢？</b>
</p>

<div class="figure">
<p><img src="../img/http/dns-arc.png" alt="dns-arc.png" width="400" />
</p>
</div>

<p>
<code>浏览器缓存-&gt;操作系统dnscache-&gt;hosts文件-&gt;非权威域名服务器-&gt;根域名服务器-&gt;顶级域名服务器-&gt;二级域名服务器-&gt;权威域名服务器</code>
</p>

<ul class="org-ul">
<li>其中非权威域名服务器还包括LDNS（企业内网DNS服务器），三大营运商DNS，谷歌公开的DNS，微软公开的DNS等
</li>
<li>操作系统 dnscache clinet 服务进行DNS缓存的（任务管理器里面可以看到一个dns客户端进程)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">域名新玩法</h3>
<div class="outline-text-3" id="text-7-2">
<ul class="org-ul">
<li>重定向：当主机有情况需要下线、迁移时，可以更改 DNS 记录，让域名指向其他的机器
</li>
<li>名字服务器：搭建一个在内部使用的 DNS，作为名字服务器
</li>
<li>负载均衡
<ul class="org-ul">
<li>因为域名解析可以返回多个 IP 地址，所以一个域名可以对应多台主机，客户端收到多个 IP 地址后，就可以自己使用轮询算法依次向服务器发起请求，实现负载均衡
</li>
<li>域名解析可以配置内部的策略，返回离客户端最近的主机，或者返回当前服务质量最好的主机，这样在 DNS 端把请求分发到不同的服务器，实现负载均衡 
</li>
</ul>
</li>
<li>恶意玩法：域名屏蔽、域名劫持
</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
